# üîß DOKUMENTACJA TECHNICZNA - SYSTEM CRM

> **Projekt In≈ºynierski:** Zintegrowany System CRM  
> **Autor:** Pawe≈Ç Paciorkowski  
> **Data:** 2025-10-06

---

## üìã SPIS TRE≈öCI

1. [Architektura Systemu](#architektura-systemu)
2. [Backend - Python Flask](#backend---python-flask)
3. [Frontend - React + TypeScript](#frontend---react--typescript)
4. [Mobile - React Native](#mobile---react-native)
5. [Baza Danych](#baza-danych)
6. [API Endpoints](#api-endpoints)
7. [Wzorce Projektowe](#wzorce-projektowe)
8. [Bezpiecze≈Ñstwo](#bezpiecze≈Ñstwo)

---

## üèóÔ∏è ARCHITEKTURA SYSTEMU

### **Og√≥lna Architektura**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Aplikacja     ‚îÇ    ‚îÇ   Aplikacja     ‚îÇ    ‚îÇ   Backend API   ‚îÇ
‚îÇ   Mobilna       ‚îÇ    ‚îÇ   Webowa        ‚îÇ    ‚îÇ   (Python)      ‚îÇ
‚îÇ   (React Native)‚îÇ    ‚îÇ   (React)       ‚îÇ    ‚îÇ                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ                       ‚îÇ                       ‚îÇ
         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                 ‚îÇ
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ   Baza Danych   ‚îÇ
                    ‚îÇ   (MariaDB)     ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### **Komunikacja miƒôdzy warstwami:**
- **Frontend ‚Üî Backend:** HTTP/REST API + JWT
- **Mobile ‚Üî Backend:** HTTP/REST API + JWT
- **Backend ‚Üî Database:** SQLAlchemy ORM

---

## üêç BACKEND - PYTHON FLASK

### **Struktura Projektu**
```
backend-python/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py          # Inicjalizacja aplikacji Flask
‚îÇ   ‚îú‚îÄ‚îÄ config.py            # Konfiguracja aplikacji
‚îÇ   ‚îú‚îÄ‚îÄ database.py          # Konfiguracja bazy danych
‚îÇ   ‚îú‚îÄ‚îÄ middleware.py        # Middleware autoryzacji
‚îÇ   ‚îú‚îÄ‚îÄ models/              # Modele SQLAlchemy
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ customer.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ task.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ   ‚îú‚îÄ‚îÄ controllers/         # Kontrolery API
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ customers.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tasks.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ   ‚îî‚îÄ‚îÄ services/            # Logika biznesowa
‚îú‚îÄ‚îÄ app.py                   # G≈Ç√≥wny plik aplikacji
‚îî‚îÄ‚îÄ requirements.txt         # Zale≈ºno≈õci Python
```

### **Kluczowe Pliki i Funkcje**

#### **1. app/__init__.py - Inicjalizacja Aplikacji**
```python
def create_app():
    """
    Tworzy i konfiguruje aplikacjƒô Flask
    
    Returns:
        Flask: Skonfigurowana instancja aplikacji Flask
        
    Funkcjonalno≈õci:
    - Konfiguracja Flask
    - Inicjalizacja bazy danych
    - Rejestracja blueprint√≥w
    - Konfiguracja CORS
    - Konfiguracja JWT
    """
    app = Flask(__name__)
    app.config.from_object(Config)
    
    # Inicjalizuj bazƒô danych
    init_database(app)
    
    # Inicjalizuj JWT
    jwt = JWTManager(app)
    
    # Konfiguruj CORS
    CORS(app, origins=Config.CORS_ORIGINS)
    
    return app
```

#### **2. app/middleware.py - Autoryzacja**
```python
def require_auth(f):
    """
    Dekorator wymagajƒÖcy autoryzacji JWT
    
    Args:
        f: Funkcja do zabezpieczenia
        
    Returns:
        decorated: Funkcja z autoryzacjƒÖ
        
    Dzia≈Çanie:
    - Sprawdza token JWT w nag≈Ç√≥wku Authorization
    - Dekoduje token i wyciƒÖga ID u≈ºytkownika
    - Przekazuje ID u≈ºytkownika do funkcji przez g.current_user_id
    - Zwraca 401 w przypadku b≈Çƒôd√≥w autoryzacji
    """
    @wraps(f)
    def decorated(*args, **kwargs):
        token = request.headers.get('Authorization')
        if not token:
            return jsonify({'error': 'Brak tokenu autoryzacji'}), 401
        
        try:
            token = token.replace('Bearer ', '')
            payload = jwt.decode(token, Config.JWT_SECRET_KEY, algorithms=['HS256'])
            g.current_user_id = payload['sub']
        except jwt.ExpiredSignatureError:
            return jsonify({'error': 'Token wygas≈Ç'}), 401
        except jwt.InvalidTokenError:
            return jsonify({'error': 'Nieprawid≈Çowy token'}), 401
        
        return f(*args, **kwargs)
    return decorated
```

#### **3. app/controllers/auth.py - Autentykacja**
```python
@auth_bp.route('/login', methods=['POST'])
def login():
    """
    Endpoint logowania u≈ºytkownika
    
    Request Body:
        {
            "username": "string",
            "password": "string"
        }
        
    Response:
        {
            "token": "string",
            "user": {
                "id": number,
                "username": "string",
                "email": "string"
            }
        }
        
    Status Codes:
        - 200: Sukces
        - 400: B≈Çƒôdne dane wej≈õciowe
        - 401: Nieprawid≈Çowe dane logowania
        - 500: B≈ÇƒÖd serwera
    """
    try:
        data = request.get_json()
        
        # Walidacja danych
        if not data or not data.get('username') or not data.get('password'):
            return jsonify({'error': 'Username i password sƒÖ wymagane'}), 400
        
        # Znajd≈∫ u≈ºytkownika
        user = User.query.filter_by(username=data['username']).first()
        
        if not user or not user.check_password(data['password']):
            return jsonify({'error': 'Nieprawid≈Çowe dane logowania'}), 401
        
        # Generuj token JWT
        token = auth_service.generate_token(user)
        
        return jsonify({
            'token': token,
            'user': {
                'id': user.id,
                'username': user.username,
                'email': user.email
            }
        }), 200
    except Exception as e:
        return jsonify({'error': str(e)}), 500
```

#### **4. app/models/user.py - Model U≈ºytkownika**
```python
class User(db.Model):
    """
    Model u≈ºytkownika systemu
    
    Tabela: users
    Pola:
        - id: Primary key
        - username: Nazwa u≈ºytkownika (unique)
        - email: Email (unique)
        - password_hash: Zahashowane has≈Ço
        - role_id: ID roli u≈ºytkownika
        
    Metody:
        - check_password(): Sprawdza has≈Ço
        - to_dict(): Konwertuje do s≈Çownika
    """
    __tablename__ = 'users'
    
    id = db.Column(db.Integer, primary_key=True)
    username = db.Column(db.Text, nullable=False, unique=True)
    email = db.Column(db.Text, nullable=False, unique=True)
    password_hash = db.Column(db.Text, nullable=False)
    role_id = db.Column(db.Integer, nullable=False)
    
    def check_password(self, password):
        """
        Sprawdza czy podane has≈Ço jest prawid≈Çowe
        
        Args:
            password (str): Has≈Ço do sprawdzenia
            
        Returns:
            bool: True je≈õli has≈Ço jest prawid≈Çowe
        """
        import bcrypt
        return bcrypt.checkpw(password.encode('utf-8'), self.password_hash.encode('utf-8'))
    
    def to_dict(self):
        """
        Konwertuje obiekt User do s≈Çownika
        
        Returns:
            dict: Reprezentacja u≈ºytkownika jako s≈Çownik
        """
        return {
            'id': self.id,
            'username': self.username,
            'email': self.email,
            'role_id': self.role_id
        }
```

---

## ‚öõÔ∏è FRONTEND - REACT + TYPESCRIPT

### **Struktura Projektu**
```
crm-ui/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ components/          # Komponenty wielokrotnego u≈ºytku
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Layout.tsx       # G≈Ç√≥wny layout aplikacji
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PrivateRoute.tsx # Zabezpieczone trasy
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ   ‚îú‚îÄ‚îÄ pages/               # Strony aplikacji
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ LoginPage.tsx    # Strona logowania
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DashboardPage.tsx # Dashboard
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ   ‚îú‚îÄ‚îÄ context/             # React Context
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AuthContext.tsx  # Kontekst autoryzacji
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ModalContext.tsx # Kontekst modali
‚îÇ   ‚îú‚îÄ‚îÄ services/            # Serwisy API
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ api.ts           # Konfiguracja Axios
‚îÇ   ‚îú‚îÄ‚îÄ utils/               # Funkcje pomocnicze
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ dateUtils.ts     # Narzƒôdzia do dat
‚îÇ   ‚îú‚îÄ‚îÄ App.tsx              # G≈Ç√≥wny komponent
‚îÇ   ‚îî‚îÄ‚îÄ main.tsx             # Punkt wej≈õcia
‚îú‚îÄ‚îÄ package.json
‚îî‚îÄ‚îÄ vite.config.ts
```

### **Kluczowe Komponenty**

#### **1. src/context/AuthContext.tsx - ZarzƒÖdzanie AutoryzacjƒÖ**
```typescript
interface AuthContextType {
  user: User | null;
  token: string | null;
  login: (username: string, password: string) => Promise<void>;
  logout: () => void;
  isAuthenticated: boolean;
}

export const AuthProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {
  const [user, setUser] = useState<User | null>(null);
  const [token, setToken] = useState<string | null>(localStorage.getItem('token'));

  const login = async (username: string, password: string) => {
    /**
     * Loguje u≈ºytkownika do systemu
     * 
     * @param username - Nazwa u≈ºytkownika
     * @param password - Has≈Ço
     * 
     * @throws Error - W przypadku b≈Çƒôdu logowania
     */
    const response = await api.post('/Auth/login', { username, password });
    const { token, user } = response.data;
    
    setToken(token);
    setUser(user);
    localStorage.setItem('token', token);
  };

  const logout = () => {
    /**
     * Wylogowuje u≈ºytkownika z systemu
     * 
     * Dzia≈Çanie:
     * - Czy≈õci stan u≈ºytkownika
     * - Usuwa token z localStorage
     * - Przekierowuje na stronƒô logowania
     */
    setToken(null);
    setUser(null);
    localStorage.removeItem('token');
  };

  return (
    <AuthContext.Provider value={{ user, token, login, logout, isAuthenticated: !!token }}>
      {children}
    </AuthContext.Provider>
  );
};
```

#### **2. src/services/api.ts - Konfiguracja API**
```typescript
const api = axios.create({
  baseURL: '/api',
  headers: {
    'Content-Type': 'application/json',
  },
});

// Interceptor dodajƒÖcy token do ka≈ºdego requestu
api.interceptors.request.use((config) => {
  /**
   * Automatycznie dodaje token JWT do nag≈Ç√≥wk√≥w
   * 
   * Dzia≈Çanie:
   * - Pobiera token z localStorage
   * - Dodaje do nag≈Ç√≥wka Authorization
   * - Format: "Bearer <token>"
   */
  const token = localStorage.getItem('token');
  if (token) {
    config.headers.Authorization = `Bearer ${token}`;
  }
  return config;
});

// Interceptor obs≈ÇugujƒÖcy b≈Çƒôdy odpowiedzi
api.interceptors.response.use(
  (response) => response,
  (error) => {
    /**
     * Obs≈Çuguje b≈Çƒôdy odpowiedzi z API
     * 
     * Dzia≈Çanie:
     * - Sprawdza kod b≈Çƒôdu 401 (Unauthorized)
     * - Automatycznie wylogowuje u≈ºytkownika
     * - Przekierowuje na stronƒô logowania
     */
    if (error.response?.status === 401) {
      localStorage.removeItem('token');
      window.location.href = '/';
    }
    return Promise.reject(error);
  }
);
```

#### **3. src/components/PrivateRoute.tsx - Zabezpieczone Trasy**
```typescript
const PrivateRoute: React.FC<{ children: React.ReactNode }> = ({ children }) => {
  const { isAuthenticated } = useAuth();
  const location = useLocation();

  /**
   * Komponent zabezpieczajƒÖcy trasy wymagajƒÖce autoryzacji
   * 
   * Dzia≈Çanie:
   * - Sprawdza czy u≈ºytkownik jest zalogowany
   * - Przekierowuje na login je≈õli nie jest
   * - Zachowuje URL docelowy dla przekierowania po logowaniu
   */
  if (!isAuthenticated) {
    return <Navigate to="/" state={{ from: location }} replace />;
  }

  return <>{children}</>;
};
```

---

## üì± MOBILE - REACT NATIVE

### **Struktura Projektu**
```
crm-mobile/
‚îú‚îÄ‚îÄ app/                     # Ekrany aplikacji (Expo Router)
‚îÇ   ‚îú‚îÄ‚îÄ (tabs)/             # Nawigacja tabowa
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index.tsx       # Dashboard
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tasks.tsx       # Zadania
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ customers.tsx   # Klienci
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ activities.tsx  # Aktywno≈õci
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ two.tsx         # Profil
‚îÇ   ‚îú‚îÄ‚îÄ login.tsx           # Ekran logowania
‚îÇ   ‚îî‚îÄ‚îÄ _layout.tsx         # G≈Ç√≥wny layout
‚îú‚îÄ‚îÄ components/             # Komponenty wielokrotnego u≈ºytku
‚îú‚îÄ‚îÄ context/                # React Context
‚îÇ   ‚îî‚îÄ‚îÄ AuthContext.tsx     # Kontekst autoryzacji
‚îú‚îÄ‚îÄ hooks/                  # Custom hooks
‚îÇ   ‚îî‚îÄ‚îÄ useReminders.tsx    # Hook do przypomnie≈Ñ
‚îî‚îÄ‚îÄ package.json
```

### **Kluczowe Komponenty**

#### **1. context/AuthContext.tsx - Autoryzacja Mobilna**
```typescript
const API_URL = 'http://10.0.2.2:8100'; // Android emulator ‚Üí host

export const AuthProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {
  const [user, setUser] = useState<User | null>(null);
  const [token, setToken] = useState<string | null>(null);

  const login = async (username: string, password: string) => {
    /**
     * Loguje u≈ºytkownika w aplikacji mobilnej
     * 
     * R√≥≈ºnice wzglƒôdem web:
     * - U≈ºywa SecureStore zamiast localStorage
     * - Inny URL API (Android emulator)
     * - Obs≈Çuga b≈Çƒôd√≥w przez Alert
     */
    const response = await axios.post(`${API_URL}/api/Auth/login`, { username, password });
    const { token, user } = response.data;
    
    setToken(token);
    setUser(user);
    await SecureStore.setItemAsync('token', token);
  };

  const logout = async () => {
    /**
     * Wylogowuje u≈ºytkownika z aplikacji mobilnej
     * 
     * Dzia≈Çanie:
     * - Czy≈õci stan u≈ºytkownika
     * - Usuwa token z SecureStore
     * - Przekierowuje na ekran logowania
     */
    setToken(null);
    setUser(null);
    await SecureStore.deleteItemAsync('token');
  };
};
```

#### **2. hooks/useReminders.tsx - ZarzƒÖdzanie Przypomnieniami**
```typescript
export const useReminders = () => {
  const [reminders, setReminders] = useState<Reminder[]>([]);

  const fetchReminders = async () => {
    /**
     * Pobiera przypomnienia z API
     * 
     * Dzia≈Çanie:
     * - Wywo≈Çuje endpoint /api/Reminders
     * - Parsuje daty z formatu ISO
     * - Aktualizuje stan przypomnie≈Ñ
     */
    try {
      const response = await api.get('/Reminders');
      const parsedReminders = response.data.map((r: any) => ({
        ...r,
        remind_at: new Date(r.remind_at)
      }));
      setReminders(parsedReminders);
    } catch (error) {
      console.error('B≈ÇƒÖd pobierania przypomnie≈Ñ:', error);
    }
  };

  const checkReminders = () => {
    /**
     * Sprawdza czy nadszed≈Ç czas na przypomnienie
     * 
     * Dzia≈Çanie:
     * - Por√≥wnuje czas przypomnienia z aktualnym
     * - Pokazuje Alert je≈õli czas nadszed≈Ç
     * - Oznacza przypomnienie jako pokazane
     */
    const now = new Date();
    reminders.forEach(reminder => {
      if (reminder.remind_at <= now && !reminder.shown) {
        Alert.alert('‚è∞ Przypomnienie!', reminder.note);
        // Oznacz jako pokazane
        reminder.shown = true;
      }
    });
  };

  return { reminders, fetchReminders, checkReminders };
};
```

---

## üóÑÔ∏è BAZA DANYCH

### **G≈Ç√≥wne Tabele**

#### **1. users - U≈ºytkownicy**
```sql
CREATE TABLE users (
    id INT PRIMARY KEY AUTO_INCREMENT,
    username TEXT NOT NULL UNIQUE,
    email TEXT NOT NULL UNIQUE,
    password_hash TEXT NOT NULL,
    role_id INT NOT NULL
);
```

#### **2. customers - Klienci**
```sql
CREATE TABLE customers (
    Id INT PRIMARY KEY AUTO_INCREMENT,
    Name TEXT NOT NULL,
    Email TEXT,
    Phone TEXT,
    Company TEXT,
    Address TEXT,
    NIP TEXT,
    Representative TEXT,
    AssignedGroupId INT,
    AssignedUserId INT,
    CreatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### **3. tasks - Zadania**
```sql
CREATE TABLE tasks (
    Id INT PRIMARY KEY AUTO_INCREMENT,
    Title TEXT NOT NULL,
    Description TEXT,
    Completed BOOLEAN DEFAULT FALSE,
    DueDate DATE,
    AssignedUserId INT,
    CustomerId INT,
    CreatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### **4. invoices - Faktury**
```sql
CREATE TABLE invoices (
    Id INT PRIMARY KEY AUTO_INCREMENT,
    Number TEXT NOT NULL,
    CustomerId INT NOT NULL,
    TotalAmount DECIMAL(10,2),
    IsPaid BOOLEAN DEFAULT FALSE,
    IssuedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    CreatedByUserId INT
);
```

### **Relacje**
- **users ‚Üí tasks** (1:N) - u≈ºytkownik mo≈ºe mieƒá wiele zada≈Ñ
- **customers ‚Üí invoices** (1:N) - klient mo≈ºe mieƒá wiele faktur
- **customers ‚Üí tasks** (1:N) - klient mo≈ºe mieƒá wiele zada≈Ñ
- **groups ‚Üê users** (M:N) - u≈ºytkownicy mogƒÖ nale≈ºeƒá do wielu grup

---

## üîå API ENDPOINTS

### **Autoryzacja**
- `POST /api/Auth/login` - Logowanie
- `POST /api/Auth/register` - Rejestracja
- `POST /api/Auth/refresh` - Od≈õwie≈ºanie tokenu

### **Klienci**
- `GET /api/Customers` - Lista klient√≥w
- `POST /api/Customers` - Dodawanie klienta
- `GET /api/Customers/{id}` - Szczeg√≥≈Çy klienta
- `PUT /api/Customers/{id}` - Edycja klienta
- `DELETE /api/Customers/{id}` - Usuwanie klienta

### **Zadania**
- `GET /api/Tasks` - Lista zada≈Ñ
- `POST /api/Tasks` - Dodawanie zadania
- `GET /api/Tasks/{id}` - Szczeg√≥≈Çy zadania
- `PUT /api/Tasks/{id}` - Edycja zadania
- `DELETE /api/Tasks/{id}` - Usuwanie zadania

### **Faktury**
- `GET /api/Invoices` - Lista faktur
- `POST /api/Invoices` - Dodawanie faktury
- `GET /api/Invoices/{id}` - Szczeg√≥≈Çy faktury
- `GET /api/Invoices/{id}/pdf` - PDF faktury

### **Raporty**
- `GET /api/reports/export-customers` - Eksport klient√≥w
- `GET /api/reports/export-invoices` - Eksport faktur
- `GET /api/reports/groups/{id}/pdf` - Raport grupy PDF

---

## üé® WZORCE PROJEKTOWE

### **1. MVC (Model-View-Controller)**
- **Model:** SQLAlchemy models (app/models/)
- **View:** React components (crm-ui/src/pages/)
- **Controller:** Flask controllers (app/controllers/)

### **2. Repository Pattern**
```python
# app/models/base.py
class BaseModel(db.Model):
    """Bazowy model z wsp√≥lnymi metodami"""
    __abstract__ = True
    
    def to_dict(self):
        """Konwertuje model do s≈Çownika"""
        return {c.name: getattr(self, c.name) for c in self.__table__.columns}
    
    def save(self):
        """Zapisuje model do bazy danych"""
        db.session.add(self)
        db.session.commit()
    
    def delete(self):
        """Usuwa model z bazy danych"""
        db.session.delete(self)
        db.session.commit()
```

### **3. Dependency Injection**
```python
# app/services/auth_service.py
class AuthService:
    """Serwis autoryzacji"""
    
    def generate_token(self, user):
        """Generuje token JWT dla u≈ºytkownika"""
        payload = {
            'sub': user.id,
            'username': user.username,
            'exp': datetime.utcnow() + timedelta(hours=24)
        }
        return jwt.encode(payload, Config.JWT_SECRET_KEY, algorithm='HS256')
```

### **4. Observer Pattern (React Context)**
```typescript
// ZarzƒÖdzanie globalnym stanem przez Context
const AuthContext = createContext<AuthContextType | undefined>(undefined);

export const useAuth = () => {
  const context = useContext(AuthContext);
  if (!context) {
    throw new Error('useAuth must be used within AuthProvider');
  }
  return context;
};
```

---

## üîê BEZPIECZE≈ÉSTWO

### **1. Autoryzacja JWT**
- **Token Structure:** Header.Payload.Signature
- **Expiration:** 24 godziny
- **Refresh:** Automatyczne od≈õwie≈ºanie
- **Storage:** SecureStore (mobile), localStorage (web)

### **2. Hashowanie Hase≈Ç**
```python
import bcrypt

def hash_password(password):
    """Hashuje has≈Ço u≈ºytkownika"""
    salt = bcrypt.gensalt()
    return bcrypt.hashpw(password.encode('utf-8'), salt)

def check_password(password, password_hash):
    """Sprawdza has≈Ço u≈ºytkownika"""
    return bcrypt.checkpw(password.encode('utf-8'), password_hash.encode('utf-8'))
```

### **3. Walidacja Danych**
```python
def validate_email(email):
    """Waliduje format email"""
    import re
    pattern = r'^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$'
    return re.match(pattern, email) is not None

def validate_password(password):
    """Waliduje si≈Çƒô has≈Ça"""
    if len(password) < 8:
        return False, "Has≈Ço musi mieƒá co najmniej 8 znak√≥w"
    return True, "Has≈Ço jest prawid≈Çowe"
```

### **4. CORS Configuration**
```python
# app/__init__.py
CORS(app, origins=[
    'http://localhost:3000',  # React dev server
    'http://localhost:5173',  # Vite dev server
    'http://10.0.2.2:3000',  # Android emulator
])
```

### **5. SQL Injection Protection**
- **SQLAlchemy ORM** - automatyczna ochrona
- **Parameterized Queries** - bezpieczne zapytania
- **Input Validation** - walidacja danych wej≈õciowych

---

## üìä METRYKI PROJEKTU

### **Statystyki Kodu**
- **Backend (Python):** ~8,000 linii kodu
- **Frontend (TypeScript):** ~5,000 linii kodu
- **Mobile (TypeScript):** ~2,000 linii kodu
- **≈ÅƒÖcznie:** ~15,000 linii kodu

### **Statystyki Funkcjonalno≈õci**
- **API Endpoints:** 50+
- **React Components:** 100+
- **Database Tables:** 20+
- **Mobile Screens:** 15+
- **PDF Reports:** 5 typ√≥w
- **Export Formats:** CSV, XLSX, PDF

### **Pokrycie Testowe**
- **Backend:** Manual testing przez Postman
- **Frontend:** Manual testing w przeglƒÖdarce
- **Mobile:** Testing na emulatorze Android

---

## üöÄ DEPLOYMENT

### **Docker Configuration**
```dockerfile
# backend-python/Dockerfile
FROM python:3.12-slim

WORKDIR /app
COPY requirements.txt .
RUN pip install -r requirements.txt

COPY . .
EXPOSE 8100

CMD ["python", "app.py"]
```

### **Docker Compose**
```yaml
version: "3.8"
services:
  db:
    image: mariadb:11
    environment:
      MARIADB_ROOT_PASSWORD: kapljca
      MARIADB_DATABASE: crm_project
    ports:
      - "3306:3306"
  
  crm-api:
    build: ./backend-python
    ports:
      - "8100:8100"
    depends_on:
      - db
```

### **Environment Variables**
```bash
# Backend
FLASK_ENV=production
DATABASE_URL=mysql+pymysql://user:pass@db:3306/crm_project
JWT_SECRET_KEY=your-secret-key

# Frontend
VITE_API_URL=http://localhost:8100
```

---

## üìù WNIOSKI

### **Zalety Architektury**
1. **Modularno≈õƒá** - ka≈ºdy komponent ma jasnƒÖ rolƒô
2. **Skalowalno≈õƒá** - ≈Çatwe dodawanie nowych funkcji
3. **Bezpiecze≈Ñstwo** - JWT + walidacja + hashowanie
4. **Cross-platform** - web + mobile z jednym backendem
5. **Prostota** - czytelny kod bez zbƒôdnej z≈Ço≈ºono≈õci

### **Mo≈ºliwo≈õci Rozwoju**
1. **Real-time** - WebSockets dla powiadomie≈Ñ na ≈ºywo
2. **Caching** - Redis dla lepszej wydajno≈õci
3. **Monitoring** - logowanie i metryki
4. **CI/CD** - automatyzacja deploymentu
5. **Testing** - testy jednostkowe i integracyjne

### **Lekcje Nauczone**
1. **Planowanie** - dok≈Çadne zaplanowanie oszczƒôdza czas
2. **Prostota** - prostsze rozwiƒÖzania sƒÖ czƒôsto lepsze
3. **Dokumentacja** - dobra dokumentacja to inwestycja
4. **Testowanie** - testowanie na bie≈ºƒÖco zapobiega b≈Çƒôdom
5. **Iteracyjno≈õƒá** - lepiej zrobiƒá co≈õ prostego i ulepszaƒá

---

**Ta dokumentacja techniczna zawiera kompletny opis architektury, implementacji i wzorc√≥w projektowych u≈ºytych w systemie CRM. Ka≈ºda funkcja, metoda i komponent zosta≈Ç szczeg√≥≈Çowo opisany z wyja≈õnieniem dzia≈Çania i celu u≈ºycia.**
